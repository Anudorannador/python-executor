# learn skill

Extract reusable skills from any source: task files, chat history, or any data-producing operation.

## Trigger

Activate when user says:
- "learn skill"
- "save as skill"
- "distill skill"
- "extract skill"

## Input Sources

Skills can be extracted from:
- `temp/.history.jsonl` - Task execution history (auto-generated by pyx)
- `temp/` task files (scripts, manifests, logs)
- Chat conversation history
- Any operation that produced data/code
- User-provided code snippets or workflows

### Using History File (Recommended)

pyx automatically logs each execution to `temp/.history.jsonl`:

```jsonl
{"ts":"2025-12-18T13:30:00","run_id":"20251218_133000","task":"fetch_prices","manifest":"fetch_prices.20251218_133000.manifest.json","success":true,"summary":"Fetch crypto OHLCV","source":"fetch_prices.py"}
```

**Workflow with history:**
1. Read `temp/.history.jsonl` (small file, ~200 bytes per entry)
2. Filter by time (last 24h / 7d) or success status
3. Show list to user, let them choose which task to learn
4. Read selected task's manifest + script header only

## Output Format: Claude SKILL Standard

```
<skill_name>/
├── SKILL.md           # Required: YAML frontmatter + markdown instructions
├── scripts/           # Optional: executable code (Python/Bash/etc.)
├── references/        # Optional: documentation loaded into context as needed
└── assets/            # Optional: templates, images, boilerplate for output
```

### SKILL.md Structure

```markdown
---
name: skill_name
description: "When to use this skill. Triggers: keyword1, keyword2."
version: 1.0.0
---

# Skill Title

Instructions in imperative form (1,500-2,000 words max).
Move detailed content to references/ for context efficiency.
```

## Storage Locations

| Location | Path | Use Case |
|----------|------|----------|
| Project | `docs/<skill_name>/SKILL.md` | Project-specific skills |
| Global | `~/.claude/skills/<skill_name>/SKILL.md` | Cross-project skills |

## Workflow

```
1. Identify source (files / chat / user input)
2. Summarize content (token-efficient)
3. Scan existing skills (headers ONLY)
4. Recommend action: create / merge / overwrite
5. Generate SKILL markdown
6. **USER CONFIRMS** -> then save
```

## Summarize Content (Token-Efficient)

**CRITICAL: DO NOT read full files. Extract summaries only.**

For files:
- Script: first 30 lines + last 10 lines
- JSON: keys only, truncate values
- Manifest: paths and sizes only
- Log: first 10 lines only

## Scan Existing Skills (Headers Only)

**CRITICAL: DO NOT read full SKILL files. Token explosion risk.**

```bash
# Project skills
ls -d docs/*/SKILL.md 2>/dev/null || echo "(none)"

# Global skills (Unix)
ls -d ~/.claude/skills/*/SKILL.md 2>/dev/null || echo "(none)"

# Global skills (Windows)
dir /b "%USERPROFILE%\.claude\skills\*\SKILL.md" 2>nul || echo "(none)"
```

For each SKILL.md, read ONLY lines 1-20 to extract name and description.

## Recommend Action

| Mode | When to Use |
|------|-------------|
| `create` | No similar skill exists |
| `merge` | Similar skill exists, add as variant/section |
| `overwrite` | Replace existing skill entirely |

**If user does not specify mode, LLM decides and proposes.**

## Preview Before Save

**ALWAYS show generated content to user before saving.**

## User Confirmation Required

**NEVER save without explicit user confirmation.**

- `create`: Show preview, ask confirm
- `merge`: Show diff, ask confirm
- `overwrite`: Show warning, ask confirm

## Related

- [MANIFEST_IO Mode](manifest-io.md) - File-first workflow for task execution
